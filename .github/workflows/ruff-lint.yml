---
name: Ruff Lint

on: pull_request

jobs:
  ruff-lint:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Checkout Head
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.ref }}
          repository: ${{ github.event.pull_request.head.repo.full_name }}

      # - name: Get changed py files
      #   id: changed-py-files
      #   uses: tj-actions/changed-files@v44
      #   with:
      #     fetch_depth: 0
      #     files: |
      #        **.py

      - name: Filter changed Python files
        id: py-filter
        uses: dorny/paths-filter@v3
        with:
          list-files: json
          filters: |
            python:
              - '**/*.py'

      - name: Install ruff 
        run: |
          pip install ruff==0.0.47

      - name: Run ruff on changed files
        run: |
          CHANGED_FILES=$(echo '${{ steps.py-filter.outputs.python_files }}' | jq -r '.[]')
          echo "CHANGED_FILES=$CHANGED_FILES"
          if [ -n "$CHANGED_FILES" ]; then
            ruff check --fix --diff $CHANGED_FILES
            ruff format --diff $CHANGED_FILES
          else
            echo "No Python files changed."
          fi

      # - name: Ruff Check
      #   if: steps.changed-py-files.outputs.any_changed == 'true'
      #   uses: chartboost/ruff-action@491342200cdd1cf4d5132a30ddc546b3b5bc531b
      #   with:
      #     args: check
      #     changed-files: 'true'

      # - name: Ruff Format
      #   if: always() && steps.changed-py-files.outputs.any_changed == 'true'
      #   uses: chartboost/ruff-action@491342200cdd1cf4d5132a30ddc546b3b5bc531b
      #   with:
      #     args: format --diff
      #     changed-files: 'true'